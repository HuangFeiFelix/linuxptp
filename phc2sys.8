.TH PHC2SYS 8 "November 2012" "linuxptp"
.SH NAME
phc2sys \- synchronize two clocks

.SH SYNOPSIS
.B phc2sys
{
.BI \-d " pps-device"
[
.BI \-s " phc-device"
|
.BI \-i " interface"
] |
.BI \-s " phc-device"
|
.BI \-i " interface"
} [
.BI \-c " phc-device"
] [
.BI \-P " kp"
] [
.BI \-I " ki"
] [
.BI \-R " update-rate"
] [
.BI \-N " clock-readings"
] [
.BI \-O " offset"
] [
.BI \-u " summary-updates"
] [
.B \-w
] [
.BI \-n " domain-number"
] [
.B \-x
] [
.BI \-l " print-level"
] [
.B \-m
] [
.B \-q
] [
.B \-v
]

.SH DESCRIPTION
.B phc2sys
is a program which synchronizes two clocks in the system. Typically, it is used
to synchronize the system clock to a PTP hardware clock (PHC), which itself is
synchronized by the
.BR ptp4l (8)
program.

Two synchronization modes are supported, one uses a pulse per second (PPS)
signal provided by the source clock and the other mode reads time from the
source clock directly. The PPS mode is usually preferred, because reading the
PHC is slow and introduces an unknown error in the readings, but not all PHCs
provide the PPS signal.

.SH OPTIONS
.TP
.BI \-d " pps-device"
Specify the PPS device of the master clock (e.g. /dev/pps0). With this option
the PPS synchronization mode is used instead of the direct mode. As the PPS
signal does not specify time and only marks start of a second, the slave clock
should be already close to the correct time before
.B phc2sys
is started or the
.B \-s
option should be used too. This option can be used only with the system clock as
the slave clock.
.TP
.BI \-s " phc-device"
Specify the master clock by device (e.g. /dev/ptp0) or name (e.g. CLOCK_REALTIME
for the system clock). When this option is used together with the
.B \-d
option, the master clock is used only to correct the offset by whole number of
seconds, which cannot be fixed with PPS alone.
.TP
.BI \-i " interface"
Similar to the
.B \-s
option, but specified by the interface which provides the master clock.
.TP
.BI \-c " phc-device"
Specify the slave clock by device (e.g. /dev/ptp1) or name. The default is
CLOCK_REALTIME (the system clock).
.TP
.BI \-P " kp"
Specify the proportional constant of the PI controller. The default is 0.7.
.TP
.BI \-I " ki"
Specify the integral constant of the PI controller. The default is 0.3.
.TP
.BI \-S " step"
Specify the step threshold of the PI controller. It is the maximum offset that
the controller corrects by changing the clock frequency instead of stepping the
clock. The clock is always stepped on start. The value of 0.0 disables stepping
after the start. The default is 0.0.
.TP
.BI \-R " update-rate"
Specify the slave clock update rate when running in the direct synchronization
mode. The default is 1 per second.
.TP
.BI \-N " phc-num"
Specify the number of master clock readings per one slave clock update. Only
the fastest reading is used to update the slave clock, this is useful to
minimize the error caused by random delays in scheduling and bus utilization.
The default is 5.
.TP
.BI \-O " offset"
Specify the offset between the slave and master times in seconds. The default
is set automatically with the
.B \-w
option, 0 otherwise.
.TP
.BI \-u " summary-updates"
Specify the number of clock updates included in summary statistics. The
statistics include offset root mean square (RMS), maximum absolute offset,
frequency offset mean and standard deviation, and mean of the delay in clock
readings and standard deviation. The units are nanoseconds and parts per
billion (ppb). If zero, the individual samples are printed instead of the
statistics. The messages are printed at the LOG_INFO level.
The default is 0 (disabled).
.TP
.B \-w
Wait until ptp4l is in a synchronized state. If the
.B \-O
option is not used, also keep the offset between the slave and master
times updated according to the currentUtcOffset value obtained from ptp4l and
the direction of the clock synchronization.
.TP
.BI \-n " domain-number"
Specify the domain number used by ptp4l. The default is 0.
.TP
.B \-x
When a leap second is announced, don't apply it in the kernel by stepping the
clock, but let the servo correct the one-second offset slowly by changing the
clock frequency (unless the
.B \-S
option is used).
.TP
.BI \-l " print-level"
Set the maximum syslog level of messages which should be printed or sent to
the system logger. The default is 6 (LOG_INFO).
.TP
.B \-m
Print messages to the standard output.
.TP
.B \-q
Don't send messages to the system logger.
.TP
.BI \-h
Display a help message.
.TP
.B \-v
Prints the software version and exits.

.SH SEE ALSO
.BR ptp4l (8)
